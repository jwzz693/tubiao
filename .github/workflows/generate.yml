name: ç”Ÿæˆå›¾æ ‡èµ„æº

on:
  push:
    paths:
      - 'src/**'
      - 'templates/**'
      - 'config.json'
      - 'scripts/**'
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘

permissions:
  contents: write

jobs:
  generate-icons:
    runs-on: ubuntu-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: è®¾ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: å®‰è£…ç³»ç»Ÿä¾èµ–
        run: |
          sudo apt-get update
          sudo apt-get install -y libcairo2-dev

      - name: å®‰è£… Python ä¾èµ–
        run: |
          pip install -r requirements.txt

      - name: ä» SVG ç”Ÿæˆ PNG æºæ–‡ä»¶
        run: python scripts/generate_svg.py

      - name: ç”Ÿæˆæ‰€æœ‰å›¾æ ‡
        run: python scripts/generate_icons.py

      - name: ç”Ÿæˆ PWA Manifest
        run: python scripts/generate_manifest.py

      - name: ä¸Šä¼ å›¾æ ‡äº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: icon-resources
          path: dist/
          retention-days: 90

      - name: æäº¤ç”Ÿæˆçš„å›¾æ ‡åˆ°ä»“åº“
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add dist/ -f
          git diff --staged --quiet || git commit -m "ğŸ¨ è‡ªåŠ¨ç”Ÿæˆå›¾æ ‡èµ„æº [skip ci]"
          git push
